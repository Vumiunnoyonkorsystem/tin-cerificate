(function(n){function r(t){return n.map(u(t),function(n){return'<input type="hidden" name="'+n.name+'" value="'+n.value+'"/>'}).join("")}function u(t){function i(n,t){r.push({name:n,value:t})}if(n.isArray(t))return t;var r=[];return typeof t=="object"?n.each(t,function(t){n.isArray(this)?n.each(this,function(){i(t,this)}):i(t,n.isFunction(this)?this():this)}):typeof t=="string"&&n.each(t.split("&"),function(){var t=n.map(this.split("="),function(n){return decodeURIComponent(n.replace(/\+/g," "))});i(t[0],t[1])}),r}function t(e,d){var a,c;if(a=n(e).contents().get(0),n.isXMLDoc(a)||a.XMLDocument)return a.XMLDocument||a;a=n(a).find("body").html();switch(d){case"xml":a=a,window.DOMParser?a=(new DOMParser).parseFromString(a,"application/xml"):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a),a=c);break;case"json":a=window.eval("("+a+")")}return a}var i=0;n.fn.upload=function(u,f,e,o){var l=this,c,a,h,v,s;return h="jquery_upload"+ ++i,v=n('<iframe name="'+h+'" style="position:absolute;top:-9999px" />').appendTo("body"),s='<form target="'+h+'" method="post" enctype="multipart/form-data" />',n.isFunction(f)&&(o=e,e=f,f={}),a=n("input:checkbox",this),h=n("input:checked",this),s=l.wrapAll(s).parent("form").attr("action",u),a.removeAttr("checked"),h.attr("checked",!0),c=(c=r(f))?n(c).appendTo(s):null,s.submit(function(){v.load(function(){var i=t(this,o),r=n("input:checked",l);s.after(l).remove(),a.removeAttr("checked"),r.attr("checked",!0),c&&c.remove(),setTimeout(function(){v.remove(),o==="script"&&n.globalEval(i),e&&e.call(l,i)},0)})}).submit(),this}})(jQuery)